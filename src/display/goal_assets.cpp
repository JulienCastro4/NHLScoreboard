#include "display/goal_assets.h"

#include <strings.h>

namespace {
    const MiniGlyph kMiniFont[] = {
        {' ', {0b000, 0b000, 0b000, 0b000, 0b000}},
        {'-', {0b000, 0b000, 0b111, 0b000, 0b000}},
        {':', {0b000, 0b010, 0b000, 0b010, 0b000}},
        {'0', {0b111, 0b101, 0b101, 0b101, 0b111}},
        {'1', {0b010, 0b110, 0b010, 0b010, 0b111}},
        {'2', {0b111, 0b001, 0b111, 0b100, 0b111}},
        {'3', {0b111, 0b001, 0b111, 0b001, 0b111}},
        {'4', {0b101, 0b101, 0b111, 0b001, 0b001}},
        {'5', {0b111, 0b100, 0b111, 0b001, 0b111}},
        {'6', {0b111, 0b100, 0b111, 0b101, 0b111}},
        {'7', {0b111, 0b001, 0b010, 0b010, 0b010}},
        {'8', {0b111, 0b101, 0b111, 0b101, 0b111}},
        {'9', {0b111, 0b101, 0b111, 0b001, 0b111}},
        {'A', {0b010, 0b101, 0b111, 0b101, 0b101}},
        {'B', {0b110, 0b101, 0b110, 0b101, 0b110}},
        {'C', {0b111, 0b100, 0b100, 0b100, 0b111}},
        {'D', {0b110, 0b101, 0b101, 0b101, 0b110}},
        {'E', {0b111, 0b100, 0b110, 0b100, 0b111}},
        {'F', {0b111, 0b100, 0b110, 0b100, 0b100}},
        {'G', {0b111, 0b100, 0b101, 0b101, 0b111}},
        {'H', {0b101, 0b101, 0b111, 0b101, 0b101}},
        {'I', {0b111, 0b010, 0b010, 0b010, 0b111}},
        {'J', {0b001, 0b001, 0b001, 0b101, 0b111}},
        {'K', {0b101, 0b101, 0b110, 0b101, 0b101}},
        {'L', {0b100, 0b100, 0b100, 0b100, 0b111}},
        {'M', {0b101, 0b111, 0b111, 0b101, 0b101}},
        {'N', {0b101, 0b111, 0b111, 0b111, 0b101}},
        {'O', {0b111, 0b101, 0b101, 0b101, 0b111}},
        {'P', {0b111, 0b101, 0b111, 0b100, 0b100}},
        {'Q', {0b111, 0b101, 0b101, 0b111, 0b001}},
        {'R', {0b111, 0b101, 0b111, 0b101, 0b101}},
        {'S', {0b111, 0b100, 0b111, 0b001, 0b111}},
        {'T', {0b111, 0b010, 0b010, 0b010, 0b010}},
        {'U', {0b101, 0b101, 0b101, 0b101, 0b111}},
        {'V', {0b101, 0b101, 0b101, 0b101, 0b010}},
        {'W', {0b101, 0b101, 0b111, 0b111, 0b101}},
        {'X', {0b101, 0b101, 0b010, 0b101, 0b101}},
        {'Y', {0b101, 0b101, 0b010, 0b010, 0b010}},
        {'Z', {0b111, 0b001, 0b010, 0b100, 0b111}}
    };

    struct TeamColors {
        const char* abbrev;
        uint16_t colors[3];
        uint8_t count;
    };
}

const MiniGlyph* getMiniGlyph(char c) {
    if (c >= 'a' && c <= 'z') c = (char)(c - 32);
    for (size_t i = 0; i < sizeof(kMiniFont) / sizeof(kMiniFont[0]); ++i) {
        if (kMiniFont[i].c == c) return &kMiniFont[i];
    }
    return &kMiniFont[0];
}

uint16_t rgb565(uint8_t r, uint8_t g, uint8_t b) {
    return (uint16_t)(((r & 0xF8) << 8) | ((g & 0xFC) << 3) | (b >> 3));
}

int getTeamColors(const char* abbrev, uint16_t* out, int maxColors) {
    if (!abbrev || !abbrev[0] || !out || maxColors <= 0) return 0;
    static const TeamColors kTeams[] = {
        {"COL", {rgb565(90, 30, 140), rgb565(0, 56, 168), rgb565(255, 255, 255)}, 3},
        {"TBL", {rgb565(255, 255, 255), rgb565(0, 56, 168), 0}, 2},
        {"CAR", {rgb565(200, 16, 46), rgb565(255, 255, 255), rgb565(128, 128, 128)}, 3},
        {"MIN", {rgb565(11, 61, 46), rgb565(200, 16, 46), rgb565(201, 163, 0)}, 3},
        {"DAL", {rgb565(0, 99, 65), rgb565(255, 255, 255), 0}, 2},
        {"DET", {rgb565(200, 16, 46), rgb565(255, 255, 255), 0}, 2},
        {"MTL", {rgb565(0, 32, 91), rgb565(255, 255, 255), rgb565(200, 16, 46)}, 3},
        {"BOS", {rgb565(255, 210, 0), rgb565(255, 255, 255), 0}, 2},
        {"PIT", {rgb565(255, 210, 0), rgb565(255, 255, 255), 0}, 2},
        {"BUF", {rgb565(0, 56, 168), rgb565(255, 255, 255), rgb565(255, 210, 0)}, 3},
        {"NYI", {rgb565(245, 125, 38), rgb565(0, 56, 168), rgb565(255, 255, 255)}, 3},
        {"VGK", {rgb565(180, 151, 90), rgb565(128, 128, 128), rgb565(255, 255, 255)}, 3},
        {"EDM", {rgb565(255, 255, 255), rgb565(245, 125, 38), rgb565(0, 56, 168)}, 3},
        {"SEA", {rgb565(122, 201, 255), rgb565(0, 70, 127), rgb565(200, 16, 46)}, 3},
        {"CBJ", {rgb565(0, 32, 91), rgb565(200, 16, 46), rgb565(255, 255, 255)}, 3},
        {"ANA", {rgb565(245, 125, 38), rgb565(255, 255, 255), 0}, 2},
        {"WSH", {rgb565(0, 32, 91), rgb565(255, 255, 255), rgb565(200, 16, 46)}, 3},
        {"LAK", {rgb565(192, 192, 192), rgb565(75, 75, 75), rgb565(255, 255, 255)}, 3},
        {"UTA", {rgb565(255, 255, 255), rgb565(122, 201, 255), 0}, 2},
        {"FLA", {rgb565(201, 163, 0), rgb565(255, 255, 255), rgb565(200, 16, 46)}, 3},
        {"OTT", {rgb565(200, 16, 46), rgb565(201, 163, 0), rgb565(255, 255, 255)}, 3},
        {"TOR", {rgb565(0, 56, 168), rgb565(255, 255, 255), 0}, 2},
        {"SJS", {rgb565(0, 99, 65), rgb565(255, 255, 255), rgb565(245, 125, 38)}, 3},
        {"PHI", {rgb565(245, 125, 38), rgb565(255, 255, 255), 0}, 2},
        {"NJD", {rgb565(255, 255, 255), rgb565(200, 16, 46), 0}, 2},
        {"NSH", {rgb565(255, 210, 0), rgb565(0, 56, 168), rgb565(255, 255, 255)}, 3},
        {"WPG", {rgb565(0, 32, 91), rgb565(255, 255, 255), rgb565(200, 16, 46)}, 3},
        {"CHI", {rgb565(255, 210, 0), rgb565(200, 16, 46), rgb565(0, 99, 65)}, 3},
        {"CGY", {rgb565(200, 16, 46), rgb565(245, 125, 38), 0}, 2},
        {"NYR", {rgb565(0, 56, 168), rgb565(255, 255, 255), rgb565(200, 16, 46)}, 3},
        {"STL", {rgb565(0, 56, 168), rgb565(255, 210, 0), 0}, 2},
        {"VAN", {rgb565(0, 32, 91), rgb565(255, 255, 255), 0}, 2}
    };

    for (size_t i = 0; i < sizeof(kTeams) / sizeof(kTeams[0]); ++i) {
        if (strcasecmp(kTeams[i].abbrev, abbrev) == 0) {
            int count = kTeams[i].count;
            if (count > maxColors) count = maxColors;
            for (int j = 0; j < count; ++j) {
                out[j] = kTeams[i].colors[j];
            }
            return count;
        }
    }
    return 0;
}
